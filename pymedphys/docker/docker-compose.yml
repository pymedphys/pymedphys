# Copyright (C) 2019 Cancer Care Associates

# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at

#     http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: "3.6"

services:
  physics-server-orthanc-machine-id-editor:
    restart: unless-stopped
    build: orthanc/orthanc-and-miniconda
    ports: ["34242:4242", "38042:8042"]

    volumes:
      - ./orthanc/orthanc.json:/etc/orthanc/orthanc.json:ro
      - ./orthanc/scripts:/etc/share/orthanc/scripts:ro
      - ../../../../../.:/usr/src/pymedphys:ro
      - pypi-cache:/root/.cache/pip:rw

    entrypoint: /bin/bash -c
    command: ['pushd /usr/src/pymedphys && yarn docker:internal && popd && /docker-entrypoint.sh --verbose /etc/orthanc']

  physics-server-nginx:
    restart: always
    image: nginx:1.15
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"

volumes:
  pypi-cache:
